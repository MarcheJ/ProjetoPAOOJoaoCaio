<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Candidates</title>
</head>
<body>
<nav>
  <a href="index.html">Home</a> |
  <a href="vacancies.html">Vacancies</a> |
  <a href="companies.html">Companies</a> |
  <a href="applications.html">Applications</a>
</nav>

<h1>Candidates</h1>
<div id="candidatesList"></div>

<form id="candidateForm">
  <label>Name:</label>
  <input type="text" id="name" required>
  <br>
  <label>Email:</label>
  <input type="email" id="email" required>
  <br>
  <label>Password:</label>
  <input type="password" id="password" required>
  <br>
  <button type="submit">Create Candidate</button>
</form>

<script>
  function renderCandidate(c) {
    const container = document.createElement('div');
    container.textContent = c.name + ' - ' + c.email;

    const resumeButton = document.createElement('button');
    resumeButton.textContent = 'Generate Resume';
    resumeButton.addEventListener('click', () => {
      fetch(`/candidates/${c.id}/resume`)
        .then(() => alert('Resume generation triggered.'))
        .catch(err => console.error('Failed to generate resume:', err));
    });
    container.appendChild(resumeButton);

    return container;
  }

  function loadCandidates() {
    fetch('/candidates')
      .then(response => response.json())
      .then(data => {
        const list = document.getElementById('candidatesList');
        list.innerHTML = ''; // Clear existing list
        data.forEach(c => {
          const div = renderCandidate(c);
          list.appendChild(div);
        });
      })
      .catch(err => console.error('Error fetching candidates:', err));
  }

  document.getElementById('candidateForm').addEventListener('submit', e => {
    e.preventDefault();
    const payload = {
      name: document.getElementById('name').value,
      email: document.getElementById('email').value,
      password: document.getElementById('password').value,
      cpf: "00000000000", // Ajustar conforme necessÃ¡rio
      birthDate: "1990-01-01", // Exemplo
      address: "Default Address"
    };

    fetch('/candidates', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(payload)
    })
    .then(() => {
      loadCandidates();
      document.getElementById('candidateForm').reset();
    })
    .catch(err => console.error('Error creating candidate:', err));
  });

  // Load candidates on initial page load
  loadCandidates();
</script>
</body>
</html>
